
===> Compare code of Tools and Examples

We have different sources:
new repo: 13Z188-06/DRIVERS/MDIS_LL/Z188/{EXAMPLE,TOOLS}
old repo: 13f404/{EXAMPLE,TEST,TOOLS}
instep:   13f404/from-instep/TOOL*
new mdis: this is equivalent with new repo
old mdis: menlinux-arch/DRIVERS/MDIS_LL/Z188/{EXAMPLE,TEST,TOOLS}

czoz@linux-x392:/data-sny/Z188> ls -l *
lrwxrwxrwx 1 czoz users 21 Jul 20 11:54 13f404 -> ../czoz/newsys/13f404        # old repo
lrwxrwxrwx 1 czoz users 24 Jul 20 11:54 13Z188-06 -> ../czoz/newsys/13Z188-06  # new repo
lrwxrwxrwx 1 czoz users 20 Jul 20 11:56 menlinux-arch -> ../czoz/opt/menlinux  # old mdis

So these are the files we deal with:
czoz@linux-x392:/data-sny/Z188> for T in  SIMP TEST READ BLKREAD ALL; do echo $T; find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep "_$T"; done
SIMP
13f404/EXAMPLE/M36_SIMP/COM/program.mak
13f404/EXAMPLE/M36_SIMP/COM/f404_simp.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/EXAMPLE/M36_SIMP/COM/program.mak
menlinux-arch/DRIVERS/MDIS_LL/Z188/EXAMPLE/M36_SIMP/COM/f404_simp.c
13Z188-06/DRIVERS/MDIS_LL/Z188/EXAMPLE/Z188_SIMP/COM/program.mak
13Z188-06/DRIVERS/MDIS_LL/Z188/EXAMPLE/Z188_SIMP/COM/z188_simp.c
TEST
13f404/TEST/M36_TEST/COM/program.mak
13f404/TEST/M36_TEST/COM/f404_test.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/TEST/M36_TEST/COM/program.mak
menlinux-arch/DRIVERS/MDIS_LL/Z188/TEST/M36_TEST/COM/f404_test.c
READ
13f404/TOOLS/M36_READ/COM/program.mak
13f404/TOOLS/M36_READ/COM/f404_read.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/program.mak
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c~
13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_READ/COM/program.mak
13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_READ/COM/z188_read.c
BLKREAD
13f404/TOOLS/M36_BLKREAD/COM/program.mak
13f404/TOOLS/M36_BLKREAD/COM/f404_blkread.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_BLKREAD/COM/program.mak
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_BLKREAD/COM/f404_blkread.c
13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_BLKREAD/COM/program.mak
13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_BLKREAD/COM/z188_blkread.c
ALL
13f404/from-instep/TOOLS_DISPLAY_ALL_COM_display_all.c-2013-09-24_v0.1
13f404/from-instep/TOOLS_DISPLAY_ALL_COM_display_all.c-2013-10-09_v0.4
13f404/from-instep/TOOLS_DISPLAY_ALL_COM_program.mak-2013-10-09_v0.4
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/program.mak
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.new
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.patch
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.bak

======================================================================================================
1) EXAMPLE/*_SIMP

czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep _SIMP | grep program.mak | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/EXAMPLE/M36_SIMP/COM/program.mak
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/EXAMPLE/M36_SIMP/COM/program.mak
--- 13f404/EXAMPLE/M36_SIMP/COM/program.mak     2017-05-09 11:37:59.684804400 +0200
+++ 13Z188-06/DRIVERS/MDIS_LL/Z188/EXAMPLE/Z188_SIMP/COM/program.mak    2017-07-14 14:51:36.344766300 +0200
@@ -20,7 +20,7 @@
 #   (c) Copyright 1998 by MEN mikro elektronik GmbH, Nuernberg, Germany
 #*****************************************************************************
 
-MAK_NAME=f404_simp
+MAK_NAME=z188_simp
 
 MAK_LIBS=$(LIB_PREFIX)$(MEN_LIB_DIR)/mdis_api$(LIB_SUFFIX)    \
          $(LIB_PREFIX)$(MEN_LIB_DIR)/usr_oss$(LIB_SUFFIX)     \
@@ -34,6 +34,6 @@
          $(MEN_INC_DIR)/usr_utl.h     \
 
 
-MAK_INP1=f404_simp$(INP_SUFFIX)
+MAK_INP1=z188_simp$(INP_SUFFIX)
 
 MAK_INP=$(MAK_INP1)
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep _SIMP | grep '\.c$' | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/EXAMPLE/M36_SIMP/COM/f404_simp.c
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/EXAMPLE/M36_SIMP/COM/f404_simp.c
  -- EQUAL: 13Z188-06/DRIVERS/MDIS_LL/Z188/EXAMPLE/Z188_SIMP/COM/z188_simp.c


===> what we have in 13Z188-06 is OK

======================================================================================================
2) TEST/*_TEST

czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep _TEST | grep program.mak | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/TEST/M36_TEST/COM/program.mak
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/TEST/M36_TEST/COM/program.mak
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep _TEST | grep '\.c$' | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/TEST/M36_TEST/COM/f404_test.c
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/TEST/M36_TEST/COM/f404_test.c

===> take it from 13f404

======================================================================================================
3) TOOLS/*_READ

czoz@linux-x392:/data-sny/Z188> TTT=_READ
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep $TTT | grep program.mak | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/TOOLS/M36_READ/COM/program.mak
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/program.mak
--- 13f404/TOOLS/M36_READ/COM/program.mak       2017-05-09 11:37:59.688804400 +0200
+++ 13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_READ/COM/program.mak      2017-07-14 14:51:36.344766300 +0200
@@ -21,7 +21,7 @@
 #   (c) Copyright 1998 by MEN mikro elektronik GmbH, Nuernberg, Germany
 #*****************************************************************************
 
-MAK_NAME=f404_read
+MAK_NAME=z188_read
 
 MAK_LIBS=$(LIB_PREFIX)$(MEN_LIB_DIR)/mdis_api$(LIB_SUFFIX)    \
          $(LIB_PREFIX)$(MEN_LIB_DIR)/usr_oss$(LIB_SUFFIX)     \
@@ -33,6 +33,6 @@
          $(MEN_INC_DIR)/usr_oss.h     \
          $(MEN_INC_DIR)/usr_utl.h     \
 
-MAK_INP1=f404_read$(INP_SUFFIX)
+MAK_INP1=z188_read$(INP_SUFFIX)
 
 MAK_INP=$(MAK_INP1)
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep $TTT | grep '\.c$' | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/TOOLS/M36_READ/COM/f404_read.c
--- 13f404/TOOLS/M36_READ/COM/f404_read.c       2017-05-09 11:37:59.688804400 +0200
+++ menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c   2013-09-19 11:40:11.951071490 +0200
@@ -225,12 +225,18 @@
                                break;
                        /* voltage */
                        case 1:
+#if 0
                                if (mode)
                                        volt = (int16)value * 20.0 / 0xffff;    /* bipolar */
                                else
                                        volt = (u_int16)value * 10.0 / 0xffff;  /* unipolar */
+#endif
+                               if (mode)
+                                       volt = (value - 0xffc) * (20.0 / 0x1d9d); /* bipolar */
+                               else
+                                       volt = (value - 0xffc) * (10.0 /0x1d9d); /* unipolar */
                                printf("read: 0x%04x = %7.4f V (%s)\n",
-                                       value, volt, (mode==0 ? "unipolar":"bipolar"));
+                                          value, volt, (mode==0 ? "unipolar":"bipolar"));
                                break;
                        /* current */
                        case 2:
--- 13f404/TOOLS/M36_READ/COM/f404_read.c       2017-05-09 11:37:59.688804400 +0200
+++ 13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_READ/COM/z188_read.c      2017-07-14 14:51:36.344766300 +0200
@@ -48,7 +48,7 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-
+#include <string.h>
 #include <MEN/men_typs.h>
 #include <MEN/usr_oss.h>
 #include <MEN/usr_utl.h>

===> our program.mak is OK
===> our z188_read.c has a fix (from M36 repo) newer than work on 13f404 ==> we keep it
===> f404_read.c from menlinux-arch has changes we should care about     ==> let's take it

There is a backup file menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c~

czoz@linux-x392:/data-sny/Z188> diff -uw menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c{~,}
--- menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c~  2013-09-19 11:37:25.931971186 +0200
+++ menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_READ/COM/f404_read.c   2013-09-19 11:40:11.951071490 +0200
@@ -230,13 +230,13 @@
                                        volt = (int16)value * 20.0 / 0xffff;    /* bipolar */
                                else
                                        volt = (u_int16)value * 10.0 / 0xffff;  /* unipolar */
-                               printf("read: 0x%04x = %7.4f V (%s)\n",
-                                       value, volt, (mode==0 ? "unipolar":"bipolar"));
 #endif
                                if (mode)
-                                       volt = (value - 0xffc) * (20.0 / 0x1d9d);
+                                       volt = (value - 0xffc) * (20.0 / 0x1d9d); /* bipolar */
                                else
-                                       volt = (value - 0xffc) * (10.0 /0x1d9d);
+                                       volt = (value - 0xffc) * (10.0 /0x1d9d); /* unipolar */
+                               printf("read: 0x%04x = %7.4f V (%s)\n",
+                                          value, volt, (mode==0 ? "unipolar":"bipolar"));
                                break;
                        /* current */
                        case 2:

===> this is not of interest

======================================================================================================
4) TOOLS/*_BLKREAD

czoz@linux-x392:/data-sny/Z188> TTT=_BLKREAD
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep $TTT | grep program.mak | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)
  13f404/TOOLS/M36_BLKREAD/COM/program.mak
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_BLKREAD/COM/program.mak
--- 13f404/TOOLS/M36_BLKREAD/COM/program.mak    2017-05-09 11:37:59.684804400 +0200
+++ 13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_BLKREAD/COM/program.mak   2017-07-14 14:51:36.344766300 +0200
@@ -21,7 +21,7 @@
 #   (c) Copyright 1998 by MEN mikro elektronik GmbH, Nuernberg, Germany
 #*****************************************************************************
 
-MAK_NAME=f404_blkread
+MAK_NAME=z188_blkread
 
 MAK_LIBS=$(LIB_PREFIX)$(MEN_LIB_DIR)/mdis_api$(LIB_SUFFIX)    \
          $(LIB_PREFIX)$(MEN_LIB_DIR)/usr_oss$(LIB_SUFFIX)     \
@@ -33,6 +33,6 @@
          $(MEN_INC_DIR)/usr_oss.h     \
          $(MEN_INC_DIR)/usr_utl.h     \
 
-MAK_INP1=f404_blkread$(INP_SUFFIX)
+MAK_INP1=z188_blkread$(INP_SUFFIX)
 
 MAK_INP=$(MAK_INP1)
czoz@linux-x392:/data-sny/Z188> find {13f404{,/from-instep},{menlinux-arch,13Z188-06}/DRIVERS/MDIS_LL/Z188}/[TE]* -type f | grep $TTT | grep '\.c$' | (read a; echo "  $a"; while read b; do cmp $a $b &>/dev/null && echo "  -- EQUAL: $b" || diff -u $a $b; done)          
  13f404/TOOLS/M36_BLKREAD/COM/f404_blkread.c
  -- EQUAL: menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/M36_BLKREAD/COM/f404_blkread.c
--- 13f404/TOOLS/M36_BLKREAD/COM/f404_blkread.c 2017-05-09 11:37:59.684804400 +0200
+++ 13Z188-06/DRIVERS/MDIS_LL/Z188/TOOLS/Z188_BLKREAD/COM/z188_blkread.c        2017-07-14 14:51:36.344766300 +0200
     [ ... 110 lines deleted ... ]

diff -u menlinux-old/DRIVERS/MDIS_LL/M036/TOOLS/M36_BLKREAD/COM/m36_blkread.c 13f404/TOOLS/M36_BLKREAD/COM/f404_blkread.c

===> This diff is empty ==> f404_blkread.c is just an unchanged older version of m36_blkread.c
===> We may skip it.
===> our program.mak is OK so we skip it, too.


======================================================================================================
5) TOOLS/DISPLAY_ALL

===> This tool is not only about z188. It deal with a components of f404

diff -u 13f404/from-instep/TOOLS_DISPLAY_ALL_COM_program.mak-2013-10-09_v0.4 menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/program.mak

===> add only one of them to JT-TOOLS

czoz@linux-x392:/data-sny/Z188> diff -u menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.patch <(diff -up menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.bak menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.new)
--- menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.patch        2013-11-05 17:40:51.391431707 +0100
+++ /dev/fd/63  2017-07-20 16:49:33.039656433 +0200
@@ -1,5 +1,5 @@
---- display_all.c      2013-10-23 13:51:37.287136163 +0200
-+++ display_all.c.new  2013-11-05 17:40:39.704824050 +0100
+--- menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.bak 2010-04-07 02:03:24.062502444 +0200
++++ menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.new 2013-11-05 17:40:39.704824050 +0100
 @@ -49,6 +49,26 @@ struct gpio {
        int32 dber_time[16];
  };

===> menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.patch can be ignored

--- menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c      2013-11-05 17:47:28.219280053 +0100
+++ menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.new  2013-11-05 17:40:39.704824050 +0100
@@ -192,7 +192,7 @@
                tbuf[strlen(tbuf) - 1] = '\0';
                printf("+----------------------------------------------+\n");
                printf("|            Display all for F404C             |\n");
-               printf("|                   Card %d                    |\n", card);
+               printf("|                   Card %d                    |\n");
                printf("|             Press 'h' for help               |\n");
                printf("|           %s           |\n", tbuf);
                printf("|----------------------------------------------|\n");

===> display_all.c.new is a broken version of display_all.c ==> skip *new

===> so these files are of some interest: (leave this token here: AXXXAYAZA)
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/program.mak
13f404/from-instep/TOOLS_DISPLAY_ALL_COM_display_all.c-2013-09-24_v0.1
13f404/from-instep/TOOLS_DISPLAY_ALL_COM_display_all.c-2013-10-09_v0.4
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c.bak
menlinux-arch/DRIVERS/MDIS_LL/Z188/TOOLS/DISPLAY_ALL/COM/display_all.c

===> diffing them show that the list above is sorted from old to new:
===> let's add all of them to JT-TOOLS in a numbered way:

cd /data-sny/Z188/; n=1
grep -A5 'AX*AYAZA' 13Z188-06/JT-TOOLS/comparison_with_f404_from_JT | tail -4 | while read a; do cp -v $a 13Z188-06/JT-TOOLS/DISPLAY_ALL/0$((n++))___`basename $a`; done

===> There was another version of display_all.c in ~men/ of old archlinux image. It looks like the very first version
===> And a script to start it properly

cp ../../root/men_tests/display_all/display_all.c JT-TOOLS/DISPLAY_ALL/00___home_men__display_all.c
cp ../../root/bin/start_display_all.sh JT-TOOLS/DISPLAY_ALL/
